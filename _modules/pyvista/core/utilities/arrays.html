


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyvista.core.utilities.arrays &mdash; PVGeo  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=d75fae25" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/style.css?v=34a7ea53" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
    <link rel="canonical" href="http://docs.pvgeo.org/_modules/pyvista/core/utilities/arrays.html"/>
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
 

<meta name="description" content="Python package of VTK-based algorithms to analyze geoscientific data and models">
<meta name="author" content="Bane Sullivan">
<meta name="keywords" content="geoscience, geophysics, python, 3D, visualization, plotting, mesh, meshviewer, vtk, open-source">

<!-- this contains PVGeo's Google analytics code - please don't copy/paste our tracking ID -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');


  ga('create', 'UA-115959679-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- This contains our AdSense code - please do not copy -->
<script data-ad-client="ca-pub-1379117569915790" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            PVGeo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Welcome to PVGeo‚Äôs code docs!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview/why-pvgeo.html">Why PVGeo?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview/featured.html">Featured</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../overview/agu-2018.html">AGU 2018</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../about-examples.html">About Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/index.html">Quick Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Index:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/PVGeo/index.html">About PVGeo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev-guide/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev-guide/repo-structure.html">Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev-guide/templates.html">Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev-guide/snippets/index.html">Development Example Snippets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev-guide/resources.html">External References</a></li>
</ul>


    
        <p class="caption">
            <span class="caption-text">
            
                Getting Connected
            
            </span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="http://slack.pyvista.org"><i class="fa fa-slack fa-fw"></i> Slack Community</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/pyvista/pyvista-support"><i class="fa fa-comment fa-fw"></i> Support</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/OpenGeoVis/PVGeo"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
                <li class="toctree-l1"><a href="https://pvgeo.org/dev-guide/contributing.html"><i class="fa fa-gavel fa-fw"></i> Contributing</a></li>
            
                <li class="toctree-l1"><a href="https://doi.org/10.21105/joss.01451"><i class="fa fa-file-text fa-fw"></i> The Paper</a></li>
            
        </ul>
    

    

    <style>
        div.extra-content {
            display: block !important;
        }
        .extra-content {
            padding: 0.5em;
            margin: 1em 0;
            padding-top: 1em;
            clear: both;
            display: none !important;
            margin-top: 1em;
            border: 0;
            /* background-color: #eee; */
            border: 1px solid #ccc;
            border-radius: 5px;
            color: #0a0a0a;
            font-size: 14px;
            line-height: 20px;
            text-align: center;
        }

        .sidebar-extra-content {
            /* RTD theme doesn't correctly set the sidebar width */
            width: 300px;
            padding: 0 1em;
        }
        .sidebar-extra-content .extra-content {
            /* RTD theme doesn't set sidebar text color */
            color: #b3b3b3;
            font-size: 14px;
            line-height: 20px;
        }

        .internal-content, .adsbygoogle {
            background-color: transparent;
            text-align: center;
        }

    </style>

    <div class="sidebar-extra-content">
        <div class="extra-content">
            <div class="internal-content">
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                <ins class="adsbygoogle"
                     style="display:inline-block;width:250px;height:250px"
                     data-ad-client="ca-pub-1379117569915790"
                     data-ad-slot="3375850680"></ins>
                <script>
                     (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            <div>
                We use ads to cover the cost of maintenance for this site and fund beverages for the occasional hackathon (üç∫ on us!)
            </div>
        </div>
    </div>




        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">PVGeo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyvista.core.utilities.arrays</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyvista.core.utilities.arrays</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Internal array utilities.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserDict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvista.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">_vtk_core</span> <span class="k">as</span> <span class="n">_vtk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvista.core.errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">AmbiguousDataError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvista.core.errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">MissingDataError</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyvista.core._typing_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">MatrixLike</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyvista.core._typing_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">NumpyArray</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyvista.core._typing_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">TransformLike</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyvista.core._typing_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">VectorLike</span>


<span class="k">class</span><span class="w"> </span><span class="nc">FieldAssociation</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents which type of vtk field a scalar or vector array is associated with.&quot;&quot;&quot;</span>

    <span class="n">POINT</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkDataObject</span><span class="o">.</span><span class="n">FIELD_ASSOCIATION_POINTS</span>
    <span class="n">CELL</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkDataObject</span><span class="o">.</span><span class="n">FIELD_ASSOCIATION_CELLS</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkDataObject</span><span class="o">.</span><span class="n">FIELD_ASSOCIATION_NONE</span>
    <span class="n">ROW</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkDataObject</span><span class="o">.</span><span class="n">FIELD_ASSOCIATION_ROWS</span>


<span class="k">def</span><span class="w"> </span><span class="nf">parse_field_choice</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a field association object for a given field type string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    field : str, FieldAssociation</span>
<span class="sd">        Name of the field (e.g, ``&#39;cell&#39;``, ``&#39;field&#39;``, ``&#39;point&#39;``,</span>
<span class="sd">        ``&#39;row&#39;``).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pyvista.FieldAssociation</span>
<span class="sd">        Field association.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;cells&#39;</span><span class="p">]:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">CELL</span>
        <span class="k">elif</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;point&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;points&#39;</span><span class="p">]:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">POINT</span>
        <span class="k">elif</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;fields&#39;</span><span class="p">]:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">NONE</span>
        <span class="k">elif</span> <span class="n">field</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">]:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">ROW</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data field (</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s1">) not supported.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">FieldAssociation</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data field (</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s1">) not supported.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">field</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_coerce_pointslike_arg</span><span class="p">(</span>
    <span class="n">points</span><span class="p">:</span> <span class="n">MatrixLike</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">VectorLike</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NumpyArray</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check and coerce arg to (n, 3) np.ndarray.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    points : MatrixLike[float] | VectorLike[float]</span>
<span class="sd">        Argument to coerce into (n, 3) :class:`numpy.ndarray`.</span>

<span class="sd">    copy : bool, default: False</span>
<span class="sd">        Whether to copy the ``points`` array.  Copying always occurs if ``points``</span>
<span class="sd">        is not :class:`numpy.ndarray`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Size ``(n, 3)`` array.</span>
<span class="sd">    bool</span>
<span class="sd">        Whether the input was a single point in an array-like with shape ``(3,)``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Given points must be convertible to a numerical array.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Array of points must be 1D or 2D&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Array of points must have three values per point (shape (n, 3))&quot;</span><span class="p">)</span>
        <span class="n">singular</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Given point must have three values&quot;</span><span class="p">)</span>
        <span class="n">singular</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">points</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">singular</span>
    <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">singular</span>


<span class="k">def</span><span class="w"> </span><span class="nf">copy_vtk_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a deep or shallow copy of a VTK array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : vtk.vtkDataArray | vtk.vtkAbstractArray</span>
<span class="sd">        VTK array.</span>

<span class="sd">    deep : bool, optional</span>
<span class="sd">        When ``True``, create a deep copy of the array. When ``False``, returns</span>
<span class="sd">        a shallow copy.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vtk.vtkDataArray or vtk.vtkAbstractArray</span>
<span class="sd">        Copy of the original VTK array.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Perform a deep copy of a vtk array.</span>

<span class="sd">    &gt;&gt;&gt; import vtk</span>
<span class="sd">    &gt;&gt;&gt; import pyvista as pv</span>
<span class="sd">    &gt;&gt;&gt; arr = vtk.vtkFloatArray()</span>
<span class="sd">    &gt;&gt;&gt; _ = arr.SetNumberOfValues(10)</span>
<span class="sd">    &gt;&gt;&gt; arr.SetValue(0, 1)</span>
<span class="sd">    &gt;&gt;&gt; arr_copy = pv.core.utilities.arrays.copy_vtk_array(arr)</span>
<span class="sd">    &gt;&gt;&gt; arr_copy.GetValue(0)</span>
<span class="sd">    1.0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="n">_vtk</span><span class="o">.</span><span class="n">vtkDataArray</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkAbstractArray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="n">new_array</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">)()</span>
    <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
        <span class="n">new_array</span><span class="o">.</span><span class="n">DeepCopy</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_array</span><span class="o">.</span><span class="n">ShallowCopy</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_array</span>


<span class="k">def</span><span class="w"> </span><span class="nf">has_duplicates</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return if an array has any duplicates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : numpy.ndarray</span>
<span class="sd">        Array to be checked for duplicates.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        ``True`` if the array has any duplicates, otherwise ``False``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">raise_has_duplicates</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise a ValueError if an array is not unique.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : numpy.ndarray</span>
<span class="sd">        Array to be checked for duplicates.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the array contains duplicate values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">has_duplicates</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Array contains duplicate values.&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">convert_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">array_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a NumPy array to a vtkDataArray or vice versa.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : np.ndarray | vtkDataArray</span>
<span class="sd">        A numpy array or vtkDataArry to convert.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        The name of the data array for VTK.</span>
<span class="sd">    deep : bool, default: False</span>
<span class="sd">        If input is numpy array then deep copy values.</span>
<span class="sd">    array_type : int, optional</span>
<span class="sd">        VTK array type ID as specified in ``vtkType.h``.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vtkDataArray or numpy.ndarray</span>
<span class="sd">        The converted array.  If input is a :class:`numpy.ndarray` then</span>
<span class="sd">        returns ``vtkDataArray`` or is input is ``vtkDataArray`` then</span>
<span class="sd">        returns NumPy ``ndarray``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">):</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;|S&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
            <span class="c1"># This handles strings</span>
            <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Do not call ascontiguousarray for scalar strings since this will reshape to 1D</span>
                <span class="c1"># and scalars are already contiguous anyway</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="n">vtk_data</span> <span class="o">=</span> <span class="n">convert_string_array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This will handle numerical data</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="n">vtk_data</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">numpy_to_vtk</span><span class="p">(</span><span class="n">num_array</span><span class="o">=</span><span class="n">arr</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span> <span class="n">array_type</span><span class="o">=</span><span class="n">array_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">vtk_data</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vtk_data</span>
    <span class="c1"># Otherwise input must be a vtkDataArray</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="n">_vtk</span><span class="o">.</span><span class="n">vtkDataArray</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkBitArray</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid input array type (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">)</span>
    <span class="c1"># Handle booleans</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkBitArray</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">vtk_bit_array_to_char</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="c1"># Handle string arrays</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">convert_string_array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="c1"># Convert from vtkDataArry to NumPy</span>
    <span class="k">return</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtk_to_numpy</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">preference</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyvista</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search point, cell and field data for an array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mesh : pyvista.DataSet</span>
<span class="sd">        Dataset to get the array from.</span>

<span class="sd">    name : str</span>
<span class="sd">        The name of the array to get the range.</span>

<span class="sd">    preference : str, default: &quot;cell&quot;</span>
<span class="sd">        When scalars is specified, this is the preferred array type to</span>
<span class="sd">        search for in the dataset.  Must be either ``&#39;point&#39;``,</span>
<span class="sd">        ``&#39;cell&#39;``, or ``&#39;field&#39;``.</span>

<span class="sd">    err : bool, default: False</span>
<span class="sd">        Whether to throw an error if array is not present.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pyvista.pyvista_ndarray or None</span>
<span class="sd">        Requested array.  Return ``None`` if there is no array</span>
<span class="sd">        matching the ``name`` and ``err=False``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkTable</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">row_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data array (</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">) not present in this dataset.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">preference</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;`preference` must be a string&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">preference</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">,</span> <span class="s1">&#39;field&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;`preference` must be either &quot;cell&quot;, &quot;point&quot;, &quot;field&quot; for a &#39;</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span><span class="si">}</span><span class="s1">, not &quot;</span><span class="si">{</span><span class="n">preference</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">parr</span> <span class="o">=</span> <span class="n">point_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">carr</span> <span class="o">=</span> <span class="n">cell_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">farr</span> <span class="o">=</span> <span class="n">field_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">preference</span> <span class="o">=</span> <span class="n">parse_field_choice</span><span class="p">(</span><span class="n">preference</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">array</span> <span class="ow">in</span> <span class="p">(</span><span class="n">parr</span><span class="p">,</span> <span class="n">carr</span><span class="p">,</span> <span class="n">farr</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">preference</span> <span class="o">==</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">CELL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">carr</span>
        <span class="k">elif</span> <span class="n">preference</span> <span class="o">==</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">POINT</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parr</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># must be field</span>
            <span class="k">return</span> <span class="n">farr</span>

    <span class="k">if</span> <span class="n">parr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parr</span>
    <span class="k">elif</span> <span class="n">carr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">carr</span>
    <span class="k">elif</span> <span class="n">farr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">farr</span>
    <span class="k">elif</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data array (</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">) not present in this dataset.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_array_association</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">preference</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="n">err</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FieldAssociation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the array association.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mesh : Dataset</span>
<span class="sd">        Dataset to get the array association from.</span>

<span class="sd">    name : str</span>
<span class="sd">        The name of the array.</span>

<span class="sd">    preference : str, default: &quot;cell&quot;</span>
<span class="sd">        When scalars is specified, this is the preferred array type to</span>
<span class="sd">        search for in the dataset.  Must be either ``&#39;point&#39;``,</span>
<span class="sd">        ``&#39;cell&#39;``, or ``&#39;field&#39;``.</span>

<span class="sd">    err : bool, default: False</span>
<span class="sd">        Boolean to control whether to throw an error if array is not</span>
<span class="sd">        present.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pyvista.core.utilities.arrays.FieldAssociation</span>
<span class="sd">        Association of the array. If array is not present and ``err`` is</span>
<span class="sd">        ``False``, ``FieldAssociation.NONE`` is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkTable</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">row_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data array (</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">) not present in this dataset.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">ROW</span>

    <span class="c1"># with multiple arrays, return the array preference if possible</span>
    <span class="n">parr</span> <span class="o">=</span> <span class="n">point_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">carr</span> <span class="o">=</span> <span class="n">cell_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">farr</span> <span class="o">=</span> <span class="n">field_array</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">parr</span><span class="p">,</span> <span class="n">carr</span><span class="p">,</span> <span class="n">farr</span><span class="p">]</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="p">[</span><span class="n">FieldAssociation</span><span class="o">.</span><span class="n">POINT</span><span class="p">,</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">CELL</span><span class="p">,</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">NONE</span><span class="p">]</span>
    <span class="n">preference</span> <span class="o">=</span> <span class="n">parse_field_choice</span><span class="p">(</span><span class="n">preference</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">preference</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preferences</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data field (</span><span class="si">{</span><span class="n">preference</span><span class="si">}</span><span class="s1">) not supported.&#39;</span><span class="p">)</span>

    <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">pref</span> <span class="k">for</span> <span class="n">pref</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">preferences</span><span class="p">,</span> <span class="n">arrays</span><span class="p">)</span> <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="c1"># optionally raise if no match</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data array (</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">) not present in this dataset.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FieldAssociation</span><span class="o">.</span><span class="n">NONE</span>
    <span class="c1"># use preference if it applies</span>
    <span class="k">if</span> <span class="n">preference</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">preference</span>
    <span class="c1"># otherwise return first in order of point -&gt; cell -&gt; field</span>
    <span class="k">return</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">raise_not_matching</span><span class="p">(</span><span class="n">scalars</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raise exception about inconsistencies.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scalars : numpy.ndarray</span>
<span class="sd">        Array of scalars.</span>

<span class="sd">    dataset : pyvista.DataSet</span>
<span class="sd">        Dataset to check against.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        Raises a ValueError if the size of scalars does not the dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkTable</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;Number of scalars (</span><span class="si">{</span><span class="n">scalars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">) must match number of rows (</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">n_rows</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;Number of scalars (</span><span class="si">{</span><span class="n">scalars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">) &#39;</span>
        <span class="sa">f</span><span class="s1">&#39;must match either the number of points (</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">n_points</span><span class="si">}</span><span class="s1">) &#39;</span>
        <span class="sa">f</span><span class="s1">&#39;or the number of cells (</span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">n_cells</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_assoc_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">association</span><span class="o">=</span><span class="s1">&#39;point&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a point, cell, or field array from a pyvista.DataSet or VTK object.</span>

<span class="sd">    If the array or index doesn&#39;t exist, return nothing. This matches VTK&#39;s</span>
<span class="sd">    behavior when using ``GetAbstractArray`` with an invalid key or index.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vtk_attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Get</span><span class="si">{</span><span class="n">association</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s1">Data&#39;</span>
    <span class="n">python_attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">association</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_data&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pyvista</span><span class="o">.</span><span class="n">DataSet</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">python_attr</span><span class="p">)</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="n">abstract_array</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">vtk_attr</span><span class="p">)()</span><span class="o">.</span><span class="n">GetAbstractArray</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">abstract_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pyvista</span><span class="o">.</span><span class="n">pyvista_ndarray</span><span class="p">(</span><span class="n">abstract_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">point_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return point array of a pyvista or vtk object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : pyvista.DataSet | vtk.vtkDataSet</span>
<span class="sd">        PyVista or VTK dataset.</span>

<span class="sd">    name : str | int</span>
<span class="sd">        Name or index of the array.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pyvista.pyvista_ndarray or None</span>
<span class="sd">        Wrapped array if the index or name is valid. Otherwise, ``None``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_assoc_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;point&#39;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">field_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return field data of a pyvista or vtk object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : pyvista.DataSet or vtk.vtkDataSet</span>
<span class="sd">        PyVista or VTK dataset.</span>

<span class="sd">    name : str | int</span>
<span class="sd">        Name or index of the array.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pyvista.pyvista_ndarray or None</span>
<span class="sd">        Wrapped array if the index or name is valid. Otherwise, ``None``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_assoc_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;field&#39;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">cell_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return cell array of a pyvista or vtk object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : pyvista.DataSet or vtk.vtkDataSet</span>
<span class="sd">        PyVista or VTK dataset.</span>

<span class="sd">    name : str | int</span>
<span class="sd">        Name or index of the array.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pyvista.pyvista_ndarray or None</span>
<span class="sd">        Wrapped array if the index or name is valid. Otherwise, ``None``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_assoc_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">row_array</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return row array of a vtk object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : vtk.vtkDataSet</span>
<span class="sd">        PyVista or VTK dataset.</span>

<span class="sd">    name : str</span>
<span class="sd">        Name of the array.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Wrapped array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vtkarr</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetRowData</span><span class="p">()</span><span class="o">.</span><span class="n">GetAbstractArray</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">convert_array</span><span class="p">(</span><span class="n">vtkarr</span><span class="p">)</span>


<div class="viewcode-block" id="get_vtk_type">
<a class="viewcode-back" href="../../../../content/PVGeo/interface.html#PVGeo.interface.get_vtk_type">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_vtk_type</span><span class="p">(</span><span class="n">typ</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Look up the VTK type for a given numpy data type.</span>

<span class="sd">    Corrects for string type mapping issues.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    typ : numpy.dtype</span>
<span class="sd">        Numpy data type.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Integer type id specified in ``vtkType.h``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">typ</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">get_vtk_array_type</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
    <span class="c1"># This handles a silly string type bug</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">13</span>
    <span class="k">return</span> <span class="n">typ</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">vtk_bit_array_to_char</span><span class="p">(</span><span class="n">vtkarr_bint</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cast vtk bit array to a char array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vtkarr_bint : vtk.vtkBitArray</span>
<span class="sd">        VTK binary array.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vtk.vtkCharArray</span>
<span class="sd">        VTK char array.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This performs a copy.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vtkarr</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkCharArray</span><span class="p">()</span>
    <span class="n">vtkarr</span><span class="o">.</span><span class="n">DeepCopy</span><span class="p">(</span><span class="n">vtkarr_bint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vtkarr</span>


<span class="k">def</span><span class="w"> </span><span class="nf">vtk_id_list_to_array</span><span class="p">(</span><span class="n">vtk_id_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a vtkIdList to a NumPy array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vtk_id_list : vtk.vtkIdList</span>
<span class="sd">        VTK ID list.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Array of IDs.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vtk_id_list</span><span class="o">.</span><span class="n">GetId</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vtk_id_list</span><span class="o">.</span><span class="n">GetNumberOfIds</span><span class="p">())])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_set_string_scalar_object_name</span><span class="p">(</span><span class="n">vtkarr</span><span class="p">:</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set object name for scalar string arrays.&quot;&quot;&quot;</span>
    <span class="c1"># This is used as a flag so that scalar arrays can be reshaped later.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vtkarr</span><span class="o">.</span><span class="n">SetObjectName</span><span class="p">(</span><span class="s1">&#39;scalar&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">vtkarr</span><span class="o">.</span><span class="n">GetObjectName</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s1">&#39;scalar&#39;</span>


<div class="viewcode-block" id="convert_string_array">
<a class="viewcode-back" href="../../../../content/PVGeo/interface.html#PVGeo.interface.convert_string_array">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_string_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a numpy array of strings to a vtkStringArray or vice versa.</span>

<span class="sd">    If a scalar string is provided, it is converted to a vtkCharArray</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : numpy.ndarray | str</span>
<span class="sd">        Numpy string array to convert.</span>

<span class="sd">    name : str, optional</span>
<span class="sd">        Name to set the vtkStringArray to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vtkStringArray</span>
<span class="sd">        VTK string array.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Note that this is terribly inefficient. If you have ideas on how</span>
<span class="sd">    to make this faster, please consider opening a pull request.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">arr</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="c1"># VTK default fonts only support ASCII. See https://gitlab.kitware.com/vtk/vtk/-/issues/16904</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">.</span><span class="n">isascii</span><span class="p">()</span>
        <span class="p">):</span>  <span class="c1"># avoids segfault</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;String array contains non-ASCII characters that are not supported by VTK.&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">vtkarr</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
            <span class="c1"># distinguish scalar inputs from array inputs by</span>
            <span class="c1"># setting the object name</span>
            <span class="n">_set_string_scalar_object_name</span><span class="p">(</span><span class="n">vtkarr</span><span class="p">)</span>

        <span class="c1">########### OPTIMIZE ###########</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="n">vtkarr</span><span class="o">.</span><span class="n">InsertNextValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1">################################</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">vtkarr</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vtkarr</span>
    <span class="c1"># Otherwise it is a vtk array and needs to be converted back to numpy</span>
    <span class="c1">############### OPTIMIZE ###############</span>
    <span class="n">nvalues</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">GetNumberOfValues</span><span class="p">()</span>
    <span class="n">arr_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">arr</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvalues</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;|U&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">GetObjectName</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;scalar&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arr_out</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">arr_out</span></div>

    <span class="c1">########################################</span>


<span class="k">def</span><span class="w"> </span><span class="nf">array_from_vtkmatrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a vtk matrix to an array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    matrix : vtk.vtkMatrix3x3 | vtk.vtkMatrix4x4</span>
<span class="sd">        The vtk matrix to be converted to a ``numpy.ndarray``.</span>
<span class="sd">        Returned ndarray has shape (3, 3) or (4, 4) as appropriate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Numpy array containing the data from ``matrix``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkMatrix3x3</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;Expected vtk.vtkMatrix3x3 or vtk.vtkMatrix4x4 input,&#39;</span>
            <span class="sa">f</span><span class="s1">&#39; got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> instead.&#39;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
        <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">GetElement</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span>


<span class="k">def</span><span class="w"> </span><span class="nf">vtkmatrix_from_array</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a ``numpy.ndarray`` or array-like to a vtk matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : array_like[float]</span>
<span class="sd">        The array or array-like to be converted to a vtk matrix.</span>
<span class="sd">        Shape (3, 3) gets converted to a ``vtk.vtkMatrix3x3``, shape (4, 4)</span>
<span class="sd">        gets converted to a ``vtk.vtkMatrix4x4``. No other shapes are valid.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vtk.vtkMatrix3x3 or vtk.vtkMatrix4x4</span>
<span class="sd">        VTK matrix.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkMatrix3x3</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, must be (3, 3) or (4, 4).&#39;</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">SetElement</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">matrix</span>


<span class="k">def</span><span class="w"> </span><span class="nf">set_default_active_vectors</span><span class="p">(</span><span class="n">mesh</span><span class="p">:</span> <span class="n">pyvista</span><span class="o">.</span><span class="n">DataSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a default vectors array on mesh, if not already set.</span>

<span class="sd">    If an active vector already exists, no changes are made.</span>

<span class="sd">    If an active vectors does not exist, it checks for possibly cell</span>
<span class="sd">    or point arrays with shape ``(n, 3)``.  If only one exists, then</span>
<span class="sd">    it is set as the active vectors.  Otherwise, an error is raised.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mesh : pyvista.DataSet</span>
<span class="sd">        Dataset to set default active vectors.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    MissingDataError</span>
<span class="sd">        If no vector-like arrays exist.</span>

<span class="sd">    AmbiguousDataError</span>
<span class="sd">        If more than one vector-like arrays exist.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">active_vectors_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">point_data</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span>
    <span class="n">cell_data</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_data</span>

    <span class="n">possible_vectors_point</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">point_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="p">]</span>
    <span class="n">possible_vectors_cell</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cell_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="p">]</span>

    <span class="n">possible_vectors</span> <span class="o">=</span> <span class="n">possible_vectors_point</span> <span class="o">+</span> <span class="n">possible_vectors_cell</span>
    <span class="n">n_possible_vectors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_vectors</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_possible_vectors</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">preference</span> <span class="o">=</span> <span class="s1">&#39;point&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_vectors_point</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;cell&#39;</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">set_active_vectors</span><span class="p">(</span><span class="n">possible_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">preference</span><span class="o">=</span><span class="n">preference</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n_possible_vectors</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingDataError</span><span class="p">(</span><span class="s2">&quot;No vector-like data available.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n_possible_vectors</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AmbiguousDataError</span><span class="p">(</span>
            <span class="s2">&quot;Multiple vector-like data available</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;cell data: </span><span class="si">{</span><span class="n">possible_vectors_cell</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;point data: </span><span class="si">{</span><span class="n">possible_vectors_point</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Set one as active using DataSet.set_active_vectors(name, preference=type)&quot;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">set_default_active_scalars</span><span class="p">(</span><span class="n">mesh</span><span class="p">:</span> <span class="n">pyvista</span><span class="o">.</span><span class="n">DataSet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a default scalars array on mesh, if not already set.</span>

<span class="sd">    If an active scalars already exists, no changes are made.</span>

<span class="sd">    If an active scalars does not exist, it checks for point or cell</span>
<span class="sd">    arrays.  If only one exists, then it is set as the active scalars.</span>
<span class="sd">    Otherwise, an error is raised.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mesh : pyvista.DataSet</span>
<span class="sd">        Dataset to set default active scalars.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    MissingDataError</span>
<span class="sd">        If no arrays exist.</span>

<span class="sd">    AmbiguousDataError</span>
<span class="sd">        If more than one array exists.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">active_scalars_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">point_data</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span>
    <span class="n">cell_data</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_data</span>

    <span class="n">possible_scalars_point</span> <span class="o">=</span> <span class="n">point_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">possible_scalars_cell</span> <span class="o">=</span> <span class="n">cell_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="n">possible_scalars</span> <span class="o">=</span> <span class="n">possible_scalars_point</span> <span class="o">+</span> <span class="n">possible_scalars_cell</span>
    <span class="n">n_possible_scalars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_scalars</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_possible_scalars</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">preference</span> <span class="o">=</span> <span class="s1">&#39;point&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_scalars_point</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;cell&#39;</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="n">possible_scalars</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">preference</span><span class="o">=</span><span class="n">preference</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n_possible_scalars</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MissingDataError</span><span class="p">(</span><span class="s2">&quot;No data available.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n_possible_scalars</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">AmbiguousDataError</span><span class="p">(</span>
            <span class="s2">&quot;Multiple data available</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;cell data: </span><span class="si">{</span><span class="n">possible_scalars_cell</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;point data: </span><span class="si">{</span><span class="n">possible_scalars_point</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Set one as active using DataSet.set_active_scalars(name, preference=type)&quot;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_coerce_transformlike_arg</span><span class="p">(</span><span class="n">transform_like</span><span class="p">:</span> <span class="n">TransformLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check and coerce transform-like arg to a 4x4 numpy array.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    transform_like : np.ndarray | vtkMatrix3x3 | vtkMatrix4x4 | vtkTransform</span>
<span class="sd">        Transformation matrix as a 3x3 or 4x4 numpy array, vtkMatrix, or</span>
<span class="sd">        from a vtkTransform.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        4x4 transformation matrix.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transform_array</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transform_like</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkMatrix4x4</span><span class="p">):</span>
        <span class="n">transform_array</span> <span class="o">=</span> <span class="n">array_from_vtkmatrix</span><span class="p">(</span><span class="n">transform_like</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transform_like</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkMatrix3x3</span><span class="p">):</span>
        <span class="n">transform_array</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_from_vtkmatrix</span><span class="p">(</span><span class="n">transform_like</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transform_like</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkTransform</span><span class="p">):</span>
        <span class="n">transform_array</span> <span class="o">=</span> <span class="n">array_from_vtkmatrix</span><span class="p">(</span><span class="n">transform_like</span><span class="o">.</span><span class="n">GetMatrix</span><span class="p">())</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transform_like</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">transform_like</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">transform_array</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">transform_like</span>
        <span class="k">elif</span> <span class="n">transform_like</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">transform_array</span> <span class="o">=</span> <span class="n">transform_like</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Transformation array must be 3x3 or 4x4.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s1">&#39;Input transform must be one of:</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">vtk.vtkMatrix4x4</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">vtk.vtkMatrix3x3</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">vtk.vtkTransform</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">4x4 np.ndarray</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">3x3 np.ndarray</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">transform_array</span>


<span class="n">_JSONValueType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="nb">dict</span><span class="p">,</span>  <span class="c1"># type: ignore[type-arg]</span>
    <span class="nb">list</span><span class="p">,</span>  <span class="c1"># type: ignore[type-arg]</span>
    <span class="nb">tuple</span><span class="p">,</span>  <span class="c1"># type: ignore[type-arg]</span>
    <span class="nb">str</span><span class="p">,</span>
    <span class="nb">int</span><span class="p">,</span>
    <span class="nb">float</span><span class="p">,</span>
    <span class="nb">bool</span><span class="p">,</span>
    <span class="kc">None</span><span class="p">,</span>
<span class="p">]</span>


<span class="c1"># TODO: add generic type annotations &#39;UserDict[str, _JSONValueType]&#39;</span>
<span class="c1">#  once support for Python 3.8 is dropped</span>
<span class="k">class</span><span class="w"> </span><span class="nc">_SerializedDictArray</span><span class="p">(</span><span class="n">UserDict</span><span class="p">,</span> <span class="n">_vtk</span><span class="o">.</span><span class="n">vtkStringArray</span><span class="p">):</span>  <span class="c1"># type: ignore[type-arg]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dict-like object with a JSON-serialized string array representation.</span>

<span class="sd">    This class behaves just like a regular dict, except its contents</span>
<span class="sd">    are represented internally as a JSON-formatted vtkStringArray.</span>
<span class="sd">    The string array is updated dynamically any time the dict is</span>
<span class="sd">    modified, such that modifying the dict will also implicitly modify</span>
<span class="sd">    its JSON string representation.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This class is intended for use as a dict with a small number of keys and</span>
<span class="sd">    relatively small values, e.g. for storing metadata. It should not be</span>
<span class="sd">    used to store frequently accessed array data with hundreds of entries.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the vtkStringArray string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetNumberOfValues</span><span class="p">())])</span>

    <span class="nd">@_string</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the vtkStringArray to a specified string.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetNumberOfValues</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Clear string</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">str_</span><span class="p">:</span>  <span class="c1"># Populate string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">InsertNextValue</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format dict data as JSON and update the vtkStringArray.&quot;&quot;&quot;</span>
        <span class="n">data_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_str</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_string</span> <span class="o">=</span> <span class="n">data_str</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return JSON-formatted dict representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_string</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Init from JSON string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">dict_</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>

        <span class="c1"># Init UserDict</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dict_</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span>

        <span class="c1"># Flag self as a scalar string</span>
        <span class="c1"># This is only needed so that the Field DatasetAttributes repr</span>
        <span class="c1"># shows this array as `str`</span>
        <span class="n">_set_string_scalar_object_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Override any/all `UserDict` or `MutableMapping` methods which mutate</span>
    <span class="c1"># the dictionary. This ensures the serialized string is also updated</span>
    <span class="c1"># and synced with the dict</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;_string&#39;</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__key</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">__key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_string</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  

 

    <div role="contentinfo">
        ¬© 2018-2020,
        <a href="http://banesullivan.com">Bane Sullivan</a><br />
        <br>
        Except where noted, this work is licensed under a
        <a rel="license" href="https://opensource.org/licenses/BSD-3-Clause">
            BSD 3-Clause License
        </a>
    </div>
    <br>
    <div>
    Built with
        <a href="http://sphinx-doc.org/">Sphinx</a>
        using a
        <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
        provided by
        <a href="https://readthedocs.org">Read the Docs</a>.
    </div>
    <div role="contentinfo">
        <br>
        This documentation was automatically generated by
        <a href="https://gendocs.readthedocs.io/en/latest/">gendocs</a><br />
    </div>




</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115959679-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-115959679-6', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>